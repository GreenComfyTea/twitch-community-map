

<p align="center">
	<h2 align="center"><b>Twitch Community Map</b></h2>
	<p align="center">A visualization of specific twitch channel communities based on @ ping sent and received in chat.</p>
	<p align="center"><b>Chrome is highly recommended! Firefox has awful Canvas performance!</b></p>
</p>

<p align="center">
	<a href="https://github.com/GreenComfyTea/twitch-community-map/graphs/contributors">
		<img alt="Contributors" src="https://custom-icon-badges.demolab.com/github/contributors/GreenComfyTea/twitch-community-map?logo=person-add" />
	</a>
	<a href="https://github.com/GreenComfyTea/twitch-community-map/issues">
		<img alt="Issues" src="https://custom-icon-badges.demolab.com/github/issues/GreenComfyTea/twitch-community-map?logo=issue-opened" />
	</a>
	<a href="https://github.com/GreenComfyTea/twitch-community-map/issues">
		<img alt="Issues Closed" src="https://custom-icon-badges.demolab.com/github/issues-closed/GreenComfyTea/twitch-community-map?logo=issue-closed" />
	</a>
	<a href="https://github.com/GreenComfyTea/twitch-community-map/pulls">
		<img alt="Pull Requests" src="https://custom-icon-badges.demolab.com/github/issues-pr/GreenComfyTea/twitch-community-map?logo=git-pull-request" />
	</a>
	<a href="https://github.com/GreenComfyTea/twitch-community-map/pulls">
		<img alt="Pull Requests Closed" src="https://custom-icon-badges.demolab.com/github/issues-pr-closed/GreenComfyTea/twitch-community-map?logo=git-pull-request-closed" />
	</a>
	<br>
	<a href="https://github.com/GreenComfyTea/twitch-community-map/blob/main/LICENSE">
		<img alt="License" src="https://custom-icon-badges.demolab.com/github/license/GreenComfyTea/twitch-community-map?logo=law" />
	</a>
	<a href="">
		<img alt="Maintenance" src="https://custom-icon-badges.demolab.com/maintenance/yes/2023?logo=tools" />
	</a>
	<br>
	<a href="https://jquery.com">
		<img alt="jQuery Dependency" src="https://custom-icon-badges.demolab.com/badge/dependency-jQuery%20v3.7.1-green?logo=package-dependencies" />
	</a>
	<a href="https://datatables.net">
		<img alt="DataTables Dependency" src="https://custom-icon-badges.demolab.com/badge/dependency-DataTables%20v1.13.7-green?logo=package-dependencies" />
	</a>
	<a href="https://gka.github.io/chroma.js">
		<img alt="chroma.js Dependency" src="https://custom-icon-badges.demolab.com/badge/dependency-chroma.js%20v2.4.2-green?logo=package-dependencies" />
	</a>
	<br>
	<a href="https://github.com/vasturiano/force-graph">
		<img alt="force-graph Dependency" src="https://custom-icon-badges.demolab.com/badge/dependency-force--graph-green?logo=package-dependencies" />
	</a>
	<a href="https://picocss.com">
		<img alt="Pico.css Dependency" src="https://custom-icon-badges.demolab.com/badge/dependency-Pico.css-green?logo=package-dependencies" />
	</a>
	<br>
	<br>
	<a href="https://github.com/GreenComfyTea/twitch-community-map/commits/main">
		<img alt="Commits" src="https://custom-icon-badges.demolab.com/github/commit-activity/t/GreenComfyTea/twitch-community-map?logo=git-commit" />
	</a>
	<a href="https://github.com/GreenComfyTea/twitch-community-map/commits/main">
		<img alt="Last Commit" src="https://custom-icon-badges.demolab.com/github/last-commit/GreenComfyTea/twitch-community-map?logo=git-commit" />
	</a>
	<br>
	<a href="https://github.com/GreenComfyTea/twitch-community-map/graphs/commit-activity">
		<img alt="Commit Activity (Year)" src="https://custom-icon-badges.demolab.com/github/commit-activity/y/GreenComfyTea/twitch-community-map?logo=pulse" />
	</a>
	<a href="https://github.com/GreenComfyTea/twitch-community-map/graphs/commit-activity">
		<img alt="Commit Activity (Month)" src="https://custom-icon-badges.demolab.com/github/commit-activity/m/GreenComfyTea/twitch-community-map?logo=pulse" />
	</a>
	<a href="https://github.com/GreenComfyTea/twitch-community-map/graphs/commit-activity">
		<img alt="Commit Activity (Week)" src="https://custom-icon-badges.demolab.com/github/commit-activity/w/GreenComfyTea/twitch-community-map?logo=pulse" />
	</a>
	<br>
	<br>
	<a href="">
		<img alt="Repo Size" src="https://custom-icon-badges.demolab.com/github/repo-size/GreenComfyTea/twitch-community-map?logo=database" />
	</a>
	<a href="">
		<img alt="Line Count" src="https://sloc.xyz/github/GreenComfyTea/twitch-community-map" />
	</a>
	<a href="">
		<img alt="COCOMO" src="https://sloc.xyz/github/GreenComfyTea/twitch-community-map/?category=cocomo" />
	</a>
	<a href="">
		<img alt="Goto Counter" src="https://custom-icon-badges.demolab.com/github/search/GreenComfyTea/twitch-community-map/goto?logo=git-compare" />
	</a>
	<br>
	<a href="https://github.com/sponsors/GreenComfyTea">
		<img alt="Sponsors" src="https://custom-icon-badges.demolab.com/github/sponsors/GreenComfyTea?logo=heart" />
	</a>
	<a href="https://github.com/GreenComfyTea/twitch-community-map/watchers">
		<img alt="Watchers" src="https://custom-icon-badges.demolab.com/github/watchers/GreenComfyTea/mhr-overlay?logo=eye" />
	</a>
	<a href="https://github.com/GreenComfyTea/twitch-community-map/forks">
		<img alt="Forks" src="https://custom-icon-badges.demolab.com/github/forks/GreenComfyTea/twitch-community-map?logo=repo-forked" />
	</a>
	<a href="https://github.com/GreenComfyTea/twitch-community-map/stargazers">
		<img alt="Stars" src="https://custom-icon-badges.demolab.com/github/stars/GreenComfyTea/twitch-community-map?logo=star" />
	</a>
	<a href="https://github.com/GreenComfyTea/twitch-community-map/graphs/traffic">
		<img alt="Hits" src="https://custom-icon-badges.demolab.com/endpoint?url=https://hits.dwyl.com/GreenComfyTea/twitch-community-map.json?color=blue&logo=eye" />
	</a>
	<br>
	<br>
	<a href="https://www.nexusmods.com/monsterhunterrise/mods/50">
		<img alt="Website" src="https://custom-icon-badges.demolab.com/website?down_color=red&down_message=down&up_color=brightgreen&up_message=up&logo=link&url=https://GreenComfyTea.github.io/twitch-community-map" />
	</a>
	<a href="https://github.com/GreenComfyTea?tab=followers">
		<img alt="Followers" src="https://custom-icon-badges.demolab.com/github/followers/GreenComfyTea?logo=people" />
	</a>
	<a href="https://twitter.com/GreenComfyTea">
		<img alt="Twitter" src="https://img.shields.io/twitter/follow/GreenComfyTea?logo=twitter" />
	</a>
	<a href="https://www.twitch.tv/GreenComfyTea">
		<img alt="Twitch" src="https://img.shields.io/twitch/status/GreenComfyTea?logo=twitch" />
	</a>
	<br>
	<a href="https://github.com/GreenComfyTea">
		<img alt="Author" src="https://custom-icon-badges.demolab.com/badge/author-GreenComfyTea-green?logo=person" />
	</a>
	<a href="https://github.com/GreenComfyTea">
		<img alt="Author" src="https://custom-icon-badges.demolab.com/badge/author-CrippledByte-25cdd4?logo=person" />
	</a>
	<a href="https://github.com/topics/open-source">
		<img alt="Open Source" src="https://img.shields.io/badge/open%20source-%20yes-brightgreen?logo=openvpn" />
	</a>
	<a href="https://www.javascript.com">
		<img alt="Written in" src="https://custom-icon-badges.demolab.com/badge/written in-html | css | js-f1e05a?logo=terminal" />
	</a>
</p>

<p align="center">
	<a>
		<img align="center" src="https://github.com/GreenComfyTea/twitch-community-map/assets/30152047/9543af72-7996-4131-a9c6-26bcf5cd6b6f" />
	</a>
</p>
<p align="center">
	<a>
		<img align="center" src="https://github.com/GreenComfyTea/twitch-community-map/assets/30152047/78543c4b-167c-4327-abff-a901ab1e10ed" />
	</a>

</p>

# Dependancies
1. **[jQuery v3.7.1](https://jquery.com)**;
2. **[DataTables v.1.13.7](https://datatables.net)**;
3. **[chroma.js v2.4.2](https://gka.github.io/chroma.js)**;
4. **[force-graph](https://github.com/vasturiano/force-graph)**;
5. **[Pico.css](https://picocss.com)**.

# How to Use:
**Due to performance issues on Firefox, currently Chrome is recommended!**

1. Map can be zoomed in, zoomed out and panned. Nodes can be dragged;
2. Selecting `Streamer`, `Year`, `Timeframe` and `Map Type` allows to load new maps;
3. Hovering a node will show a tooltip with `Username`, `User Type`, `Pings Received` and `Pings Sent` information;
5. `Legend Info Menu` on the left can be hidden/shown by pressing the arrow;
6.  In `Legend Info Menu` on the left pressing on `User Type` `Circle` or `Text` will zoom into a next user of that type and also scroll the `Leaderboard` to that user;
7. `Chatter Count` and `Link Count` on the bottom left can hidden/shown by pressing the arrow;
8. `Min Pings`will filter out the nodes and links that do not qualify. Always filters based on the current map type. Increasing the value can improve performance.
9. `Search` function searches the user with that twitch name. It will zoom into a found user and also scroll the `Leaderboard` to that user;
10. `Performance Mode` disables fancy style and improves performance (recommended for big maps);
11. `Leaderboard` can be hidden/shown by pressing the arrow;
12. `Leaderboard` Headers are clickable and determine the sorting;
13. Pressing a user on `Leadeboard` will zoom into that user. 

# Contribution
If you wish to contribute to the project, feel free to make a pull request!

Currently the project is based on **[force-graph](https://github.com/vasturiano/force-graph)** which uses **Canvas** rendering. We were looking at **[sigma.js](https://sigmajs.org/)** for **WebGL** rendering but a complete lack of documentation was a deal breaker. If anyone were to implement it without losing existing functionality we would very grateful.

Moreover, **Firefox** Canvas support is almost **10 times worse** than the one in **Chrome**. Performance improvements would be much appreciated as well!

For those who want to add new maps for more streamers and/or timeframes, pull requests must follow a specific folder structure and json format (without `[ ]`).
```
root/
	data/
		[STREAMER_NAME]/
			[YEAR]/
				[TIMEFRAME]/
					[STREAMER_NAME]_[YEAR]_[TIMEFRAME]_pingsSent.json
					[STREAMER_NAME]_[YEAR]_[TIMEFRAME]_pingsReceived.json
```
**`[YEAR]`**: must be a numeric value;  
**`[TIMEFRAME]`**: must be a numeric value of a month (ex.:`01`, `02`, ... `12`) or a `year` keyword;  

Each `[TIMEFRAME]` must contain 2 json files named as displayed above, with 1 exception:
 - If `[TIMEFRAME]` is `year` than `[TIMEFRAME]` is dropped:
 ```
			[STREAMER_NAME]_[YEAR]_pingsSent.json
			[STREAMER_NAME]_[YEAR]_pingsReceived.json
 ```

The content of json files can be in 2 formats:
 1. **Default json**. Will use force physics simulation to generated a node layout on each map load client-side (can be undesirable for big maps);
 2. **[Gephi](https://gephi.org/)-exported json**. Includes a pregenerated in Gephi layout in a form of added `x` and `y` fields. Force physics is disabled.

#### First Format:
```
{
	"nodes": [
		{
			"name": "",
			"displayName": "",
			"userType": "", 
			"pingsReceived": 0,
			"pingsSent": 0
		},
		{...},
		{...},
		{...},
		...
	],
	"links": [
		{
			"source": "",
			"target": "",
			"userType": "",
			"weight": 0,
		},
		{...},
		{...},
		{...},
		...
	]
}
```
#### Second Format:
```
{
	"attributes": {
		...
	},
	"options": {
		...
	},
	"nodes": [
		{
			"key": "",
			"attributes": {
				"label": "",
				"usertype": "", 
				"pingsreceived": 0,
				"pingssent": 0,
				"x": 0,
				"y": 0
			}
		}
		{...},
		{...},
		{...},
		...
	],
	"links": [
		{
			"source: "",
			"target: "",
			"attributes: {
				"usertype": "",
				"weight": 0,
			}
		}
		{...},
		{...},
		{...},
		...
	]
}
```


**Node:**  
  
`name`/`key`: [Unique] Twitch Username in lower case, corresponds to `link` -> `source` and `target` fields;  
`displayName`/`label`: [Optional] Twitch Display Name;  
`userType`/`usertype`:	must be one of the following, determines the colors:  
 - `Streamer`
 - `Staff`
 - `Moderator`
 - `VIP`
 - `Artist`
 - `Partner`
 - `Subscriber`
 - `Viewer`

`pingsReceived`/`pingsreceived`: how many times a user has been pinged by others, determines the size of a node;  
`pingsSent`/`pingssent`: how many times a user pinged others, determines the size of a node.  

> [!NOTE]  
> `pingsReceived` and `pingsSent` must be present in both json files. The reason is that both values are displayed on the leaderboard and in the tooltip, regardless of which map is loaded. 

**Link:**  
  
`source`:  Twitch Username in lower case, corresponds with `node` -> `name` field;  
`target`:  Twitch Username in lower case, corresponds with `node` -> `name` field;  
`userType`/`usertype`:  must match  `userType` of `source` or `target` node `userType` (the type of higher priority must be used), must be one of the following, determines the color:
 - `Streamer`
 - `Staff`
 - `Moderator`
 - `VIP`
 - `Artist`
 - `Partner`
 - `Subscriber`
 - `Viewer`

`weight`: pings exchanged between 2 users (`source` and `target`), determines the line width.

> [!NOTE]  
> All links are undirected, means that these 2 links:  
> `source: "user1", target: "user2"`  
> `source: "user2", target: "user1"`  
> are the same and must be combined into 1 object. Having both will result in drawing same link line twice, which is undesirable performance-wise.


P.S. I might add a web tool later for semi-automatic chat log parsing (from gempir's justlog) into the 1st format.

# Gephi Layout
I generated `HAchubby` map layouts in [Gephi](https://gephi.org/) using the following settings:

*For ~1000 nodes, adjust for smaller/bigger maps proportionally;

1. **Random Layout**
	- `Space Size`: 2500.0*
2. **Yifan Hu**
	- `Optimal Distance`: 500.0*
	- `Relative Strength`: 0.1
	- `Initial Step Size`: 5.0
	- `Step Ratio`: 0.5*
 	- `Adaptive Cooling`: On
	- `Quadtree Max Level`: 16
	- `Theta`: 0.2
3. **ForceAtlas 2**
	- `Tolerance(speed)`: 1.0
	- `Approximate Repulsion`: Yes
	- `Approximation`: 0.8
	- `Scaling`: 50.0*
	- `Stronger Gravity`: No
	-  `Gravity`: 1.0
	- `Dissuade Hubs`: No
	- `LinLog Mode`: No
	- `Prevent Overlap`: Yes
	- `Edge Weight Influence`: 1.0
	- `Normalize Edge Weights`: No
	- `Inverted Edge Weights`: No
4. **ForceAtlas 2**
	- `Inverted Edge Weights`: Yes
5. **ForceAtlas 2**
	- `Normalize Edge Weights`: Yes
6. **ForceAtlas 2**
	- `LinLog Mode`: Yes
7. **ForceAtlas 2**
	- `Dissuade Hubs`: Yes
8. **ForceAtlas 2**
	- `Dissuade Hubs`: No
9. **ForceAtlas 2**
	- `LinLog Mode`: No
10. **ForceAtlas 2**
	- `Normalize Edge Weights`: No
11. **ForceAtlas 2**
	- `Inverted Edge Weights`: No
12. **Yifan Hu**
	- Same settings as before;
13. **Noverlap**
	- `Speed`: 10.0*
	- `Ratio: 0.9
	- `Margin: 5.0
14. **Label Adjust**
	- `Speed`: 5.0*
	- `Include Node Size`: On

# Credits
**[GreenComfyTea](https://github.com/GreenComfyTea)** - creator of the website and it's main contributor.  
**[CrippledByte](https://github.com/CrippledByte)** - provider of chat logs. 


***
# Support

You can support me by donating! I would appreciate it! But anyway, thank you for using this mod!

 <a href="https://streamelements.com/GreenComfyTea/tip">
  <img alt="Donate" src="https://panels.twitch.tv/panel-48897356-image-c6155d48-b689-4240-875c-f3141355cb56">
</a>
<a href="https://ko-fi.com/GreenComfyTea">
  <img alt="Buy me a tea" src="https://panels.twitch.tv/panel-48897356-image-c2fcf835-87e4-408e-81e8-790789c7acbc">
</a>
